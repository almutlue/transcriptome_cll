---
title: "Generate figures"
author: "almut"
date: "18 November 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Generate Figures - Figure1

```{r}
suppressPackageStartupMessages({
  library(DESeq2)
  library(dplyr)
  library(ggplot2)
  library(tidyverse)
  library(ComplexHeatmap)
  library(ggpubr)
  library(RColorBrewer)
  library(circlize)
  library(here)
  library(cowplot)
})
```
 
 
data objects 
```{r objects}
output_dir <- here("output/figures/paper_fig")
fig_dir <- here("output/figures/r_objects")

general_hmap <-  readRDS(paste0(fig_dir,"/heatmap_top500genes.rds"))
general_hmap <- grid.grabExpr(draw(general_hmap))
de_gene_sub <- readRDS(paste0(fig_dir,"/summary_de_genes_IGHV_tri12.rds"))
de_gene_all <- readRDS(paste0(fig_dir,"/summary_de_genes_all.rds"))

pca_IGHV <- readRDS(paste0(fig_dir,"/pca_top500genes.rds"))[["IGHV"]]
pca_tri12 <- readRDS(paste0(fig_dir,"/pca_top500genes.rds"))[["trisomy12"]]
pca_meth <- readRDS(paste0(fig_dir,"/pca_top500genes.rds"))[["Methylation"]]



```

### Arrange plots in to figure

```{r arrange plots, fig.width=18, fig.height= 20}
#Align subplots
p_sub <- plot_grid(NULL, de_gene_sub, de_gene_all, ncol = 1, rel_heights = c(2, 4, 11), align = "v")
p_sub <- plot_grid(p_sub, NULL, rel_widths = c(10, 2))
p_sub2 <- plot_grid(pca_IGHV, pca_tri12, pca_meth, align = "v", ncol = 1, labels = c('C', 'D' ,'E'), label_size = 45)
p_sub_3 <- plot_grid(general_hmap, p_sub, ncol = 1, rel_heights = c(4, 3), labels = c('A', 'B'), label_size = 45)

figure1 <- plot_grid(p_sub_3, p_sub2, ncol = 2, rel_widths =c(4,3))
figure1
ggsave(filename = paste0(output_dir, "/figure1.pdf"), plot = figure1)
ggsave(filename = paste0(output_dir, "/figure1.svg"), plot = figure1)

```

### figure2
```{r fig2 objects}

ighv_net <-  readRDS(paste0(fig_dir,"/ighv/enrich_net_kegg.rds"))
#ighv_net <- grid.grabExpr(draw(ighv_net))
#pathways <- readRDS(paste0(fig_dir,"/ighv/ighv_enrichment_dn.rds"))
pathways <- readRDS(paste0(fig_dir,"/ighv/enrich_dot_hm.rds"))
ighv_ig <- readRDS(paste0(fig_dir,"/ighv/ighv_gene_status.rds"))

de1 <- readRDS(paste0(fig_dir,"/ighv/de_genes/BCAT1.rds"))
de2 <- readRDS(paste0(fig_dir,"/ighv/de_genes/EGR3.rds"))
de3 <- readRDS(paste0(fig_dir,"/ighv/de_genes/ZAP70.rds"))


```


```{r fig2 plot, fig.width=20, fig.height= 24}
#Align subplots
#pathw <- plot_grid(NULL, pathways, NULL, ncol = 3, rel_widths = c(1, 8, 1))
p_sub <- plot_grid(NULL, ighv_ig, NULL, ncol = 3, rel_widths = c(1,8,1), labels = c('B','',''), label_size = 45)
#p_sub <- plot_grid(p_sub, NULL, rel_widths = c(10, 2))
p_sub2 <- plot_grid(NULL, de1, de2, de3, NULL, ncol = 1, labels = c('', 'C', 'D', 'E', ''), label_size = 45, rel_heights = c(0.5, 4, 4, 4, 0.5))
p_sub_3 <- plot_grid(ighv_net, NULL, p_sub, NULL, ncol = 1, rel_heights = c(7.5, 0.8, 4, 0.6), labels = c("A", ""), label_size = 45)

figure2 <- plot_grid(p_sub_3, NULL, p_sub2, NULL, ncol = 4, rel_widths = c(8, 0.5, 5, 0.1))
figure2
ggsave(filename = paste0(output_dir, "/figure_IGHV.pdf"), plot = figure2)
ggsave(filename = paste0(output_dir, "/figure_IGHV.svg"), plot = figure2)


```


### figure 3
```{r fig3 objects}

tri12_net <-  readRDS(paste0(fig_dir,"/trisomy12/enrich_net_kegg.rds"))
pathways <- readRDS(paste0(fig_dir,"/trisomy12/enrich_dot_hm.rds"))
dosage <- readRDS(paste0(fig_dir,"/trisomy12/tri12_dosage.rds"))

de1 <- readRDS(paste0(fig_dir,"/trisomy12/de_genes/VAV1.rds"))
de2 <- readRDS(paste0(fig_dir,"/trisomy12/de_genes/NT5E.rds"))
de3 <- readRDS(paste0(fig_dir,"/trisomy12/de_genes/CTLA4.rds"))


```


```{r fig3 plot, fig.width=20, fig.height= 22}
p_sub <- plot_grid(NULL, dosage, NULL, ncol = 3, rel_widths = c(1.2,8,1.2), labels = c('A','',''), label_size = 45)
#p_sub <- plot_grid(p_sub, NULL, rel_widths = c(10, 2))
p_sub2 <- plot_grid(NULL, de1, de3, de2, NULL, ncol = 1, labels = c('', 'C', 'D', 'E', ''), label_size = 45, rel_heights = c(0.5, 4, 4, 4, 0.5))
p_sub_3 <- plot_grid(NULL, p_sub, NULL, tri12_net, NULL, ncol = 1, rel_heights = c(0.4, 4, 0.4, 7.5, 0.5), labels = c("","", "B"), label_size = 45)

figure3 <- plot_grid(p_sub_3, NULL, p_sub2, NULL, ncol = 4, rel_widths = c(8, 0.5, 5, 0.1))
figure3

#Align subplots
# p_sub <- plot_grid(NULL, dosage, NULL, pathways, ncol = 1, rel_heights = c(1,10,1, 9), labels = c('B','', 'C',''), label_size = 45)
# #p_sub <- plot_grid(p_sub, NULL, rel_widths = c(10, 2))
# p_sub2 <- plot_grid(de1, de2, de3, ncol = 3, align = "v", axis = "b", labels = c('D', 'E', 'F'), label_size = 45)
# p_sub_3 <- plot_grid(tri12_net, p_sub, rel_widths = c(5, 4), labels = c("A", ""), label_size = 45, ncol = 2)
# 
# figure3 <- plot_grid(p_sub_3, NULL, p_sub2, ncol = 1, rel_heights = c(13, 1, 6))
# figure3
ggsave(filename = paste0(output_dir, "/figure_tri12.pdf"), plot = figure3)
ggsave(filename = paste0(output_dir, "/figure_tri12.svg"), plot = figure3)
```
 
 
 ### figure 4
```{r fig4 objects}

epi_hmap <-  readRDS(paste0(fig_dir,"/epistasis/epistasis_heatmap.rds"))
epi_hmap <- grid.grabExpr(draw(epi_hmap))
types <- readRDS(paste0(fig_dir,"/epistasis/epistasis_scheme_lolli.rds"))
#types <- grid.grabExpr(draw(types))
path_epi <- readRDS(paste0(fig_dir,"/epistasis/enrich_dot_buffering.rds"))

de1 <- readRDS(paste0(fig_dir,"/epistasis/de_genes/EBF1.rds"))
de2 <- readRDS(paste0(fig_dir,"/epistasis/de_genes/FGF2.rds"))
de3 <- readRDS(paste0(fig_dir,"/epistasis/de_genes/SYBU.rds"))
de4 <- readRDS(paste0(fig_dir,"/epistasis/de_genes/LEF1.rds"))


```


```{r fig4 plot, fig.width=18, fig.height= 24}
#Align subplots
p_sub2 <- plot_grid(de1, de2, de3, de4, ncol = 1, align = "v", axis = "b", labels = c('A', 'B', 'C', 'D'), label_size = 45)
p_sub3 <- plot_grid(NULL, p_sub2, NULL, ncol = 3, rel_widths = c(1.5 , 10, 1.5))
p_sub1 <- plot_grid(types, NULL,  ncol = 2, rel_widths = c(10, 1))
p_sub6 <- plot_grid(NULL, epi_hmap,  ncol = 2, rel_widths = c(1, 10))
p_sub <- plot_grid(NULL, p_sub1, NULL, p_sub6, ncol = 1, rel_heights = c(0.5, 4.5, 0.5, 8), labels = c('E','', 'G',''), label_size = 45)

p_sub5 <- plot_grid(p_sub2, NULL, path_epi, ncol = 1, rel_heights = c(13, 0.5, 4), labels = c("", "F", ""), label_size = 45)

figure4 <- plot_grid(p_sub5, NULL, p_sub, ncol = 3, rel_widths = c(10, 0.1, 11))
figure4
ggsave(filename = paste0(output_dir, "/figure_epi.pdf"), plot = figure4)
ggsave(filename = paste0(output_dir, "/figure_epi.svg"), plot = figure4)
```
 
 
### figure 5
supplement figure adapter trimming
```{r fig5 objects}

adatper_cont <-  readRDS(paste0(fig_dir,"/adapter/batch_n_adapter.rds"))
pca_old <- readRDS(paste0(fig_dir,"/adapter/pca_before_trimming.rds"))
pca_new <- readRDS(paste0(fig_dir,"/adapter/pca_after_trimming.rds"))


```


```{r fig5 plot, fig.width=20, fig.height= 17}
#Align subplots
p_sub <- plot_grid(NULL, adatper_cont, NULL, align = "h", rel_widths = c(1,3,1), ncol = 3)
p_sub2 <- plot_grid(NULL, p_sub, NULL, pca_old, NULL, pca_new, ncol = 1, align = "v", 
                    axis = "b", labels = c('', 'A', '', 'B', '', 'C'), 
                    rel_heights = c(0.05, 1, 0.1, 1, 0.1, 1), label_size = 45)
figure5 <- plot_grid(NULL, p_sub2, NULL, ncol = 3, rel_widths = c(0.5, 10, 0.5))
figure5

ggsave(filename = paste0(output_dir, "/figure_adapter.pdf"), plot = figure5)
ggsave(filename = paste0(output_dir, "/figure_adapter.svg"), plot = figure5)
```
 

### figure 6
supplement figure c1c2 groups
```{r fig6 objects}

c1c2 <-  readRDS(paste0(fig_dir,"/mean_sd_by_c1c2.rds"))
sd <- c1c2$sd
category <- c1c2$category


```


```{r fig6 plot, fig.width=13.5, fig.height= 6}
figure6 <- plot_grid(category, sd, ncol = 2, rel_widths = c(1,1), labels = c('A', 'B'), label_size = 30)
figure6

ggsave(filename = paste0(output_dir, "/figure_c1c2.pdf"), plot = figure6)
ggsave(filename = paste0(output_dir, "/figure_c1c2.svg"), plot = figure6)
```



### figure 7
supplement figure variants and mutational load
```{r fig7 objects}

var_freq <-  readRDS(paste0(fig_dir,"/summary_var_freq_IGHV.rds")) + xlab("variant") + ylab("IGHV status") + labs(fill = "#sample")
mut_load <-  readRDS(paste0(fig_dir,"/summary_variant_patient.rds"))



```


```{r fig7 plot, fig.width=16, fig.height= 12}
mut <- plot_grid(NULL, mut_load, NULL, align = "h", rel_widths = c(1,3,1), ncol = 3)
figure7 <- plot_grid( mut, NULL, var_freq, ncol = 1, rel_heights = c(1,0.1,1), labels = c('A', 'B', ''), label_size = 45)
figure7

ggsave(filename = paste0(output_dir, "/figure_variants_mut_load.pdf"), plot = figure7)
ggsave(filename = paste0(output_dir, "/figure_variants_mut_load.svg"), plot = figure7)
```

### figure 8
supplement figure methylation epistasis
```{r fig8 objects}

meth_hmap <-  readRDS(paste0(fig_dir,"/epistasis/epi_methylation_heatmap.rds"))
meth_hmap <- grid.grabExpr(draw(meth_hmap))
gene_1 <-  readRDS(paste0(fig_dir,"/epi_meth/de_genes/DGKD.rds"))
gene_2 <-  readRDS(paste0(fig_dir,"/epi_meth/de_genes/ZNF608.rds"))
gene_3 <-  readRDS(paste0(fig_dir,"/epi_meth/de_genes/PRDM16.rds"))
gene_4 <-  readRDS(paste0(fig_dir,"/epi_meth/de_genes/ABR.rds"))


```


```{r fig8 plot, fig.width=20, fig.height= 18}
p_hmap <- plot_grid(NULL, meth_hmap, NULL, ncol = 1, rel_heights = c(1.2,8,1.2), labels = c('A','',''), label_size = 45)
p_sub <- plot_grid(gene_1, gene_2, gene_3, gene_4, ncol = 1, labels = c('B', 'C', 'D', 'E'), label_size = 45, rel_heights = c(1,1,1,1))


figure8 <- plot_grid(p_hmap, p_sub, ncol = 2, rel_widths = c(6,5))
figure8



ggsave(filename = paste0(output_dir, "/figure_epi_meth.pdf"), plot = figure8)
ggsave(filename = paste0(output_dir, "/figure_epi_meth.svg"), plot = figure8)
```



### Figure 9
supplement figure SF3B1
```{r fig2 objects}

sf3b1_net <-  readRDS(paste0(fig_dir,"/SF3B1/enrich_net_kegg.rds"))
#ighv_net <- grid.grabExpr(draw(ighv_net))
de1 <- readRDS(paste0(fig_dir,"/SF3B1/de_genes/UQCC1.rds"))
de2 <- readRDS(paste0(fig_dir,"/SF3B1/de_genes/PSD2.rds"))
de3 <- readRDS(paste0(fig_dir,"/SF3B1/de_genes/SRRM5.rds"))
de4 <- readRDS(paste0(fig_dir,"/SF3B1/de_genes/TNXB.rds"))

```


```{r fig2 plot, fig.width=20, fig.height= 24}
#Align subplots
#pathw <- plot_grid(NULL, pathways, NULL, ncol = 3, rel_widths = c(1, 8, 1))
p_sub <- plot_grid(NULL, sf3b1_net, NULL, ncol = 1, rel_heights = c(1,8,1), labels = c('','A',''), label_size = 45)
#p_sub <- plot_grid(p_sub, NULL, rel_widths = c(10, 2))
p_sub2 <- plot_grid(NULL, de1, de2, de3, de4, NULL, ncol = 1, labels = c('', 'B', 'C', 'D', 'E', ''), label_size = 45, rel_heights = c(0.5, 4, 4, 4, 4, 0.5))


figure2 <- plot_grid(p_sub, NULL, p_sub2, ncol = 3, rel_widths = c(8, 0.5, 5))
figure2
ggsave(filename = paste0(output_dir, "/figure_SF3B1.pdf"), plot = figure2)
ggsave(filename = paste0(output_dir, "/figure_SF3B1.svg"), plot = figure2)


```
### Figure 9
supplement figure TP53
```{r fig2 objects}

tp_net <-  readRDS(paste0(fig_dir,"/TP53/enrich_net_kegg.rds"))
#ighv_net <- grid.grabExpr(draw(ighv_net))
de1 <- readRDS(paste0(fig_dir,"/TP53/de_genes/CDK12.rds"))
de2 <- readRDS(paste0(fig_dir,"/TP53/de_genes/PGBD2.rds"))
de3 <- readRDS(paste0(fig_dir,"/TP53/de_genes/HYPK.rds"))
de4 <- readRDS(paste0(fig_dir,"/TP53/de_genes/MDM2.rds"))
venn_o <- readRDS(paste0(fig_dir,"/TP53/venn_pair.rds"))
venn <- grid.grabExpr(grid.draw(venn_o))

```


```{r fig2 plot, fig.width=20, fig.height= 24}
#Align subplots
#pathw <- plot_grid(NULL, pathways, NULL, ncol = 3, rel_widths = c(1, 8, 1))
p_sub <- plot_grid(tp_net, venn, ncol = 1, rel_heights = c(8,3), labels = c('A','B'), label_size = 45)
#p_sub <- plot_grid(p_sub, NULL, rel_widths = c(10, 2))
p_sub2 <- plot_grid(NULL, de1, de2, de3, NULL, ncol = 1, labels = c('', 'C', 'D', 'E', ''), label_size = 45, rel_heights = c(0.5, 4, 4, 4, 0.5))


figure2 <- plot_grid(p_sub, NULL, p_sub2, ncol = 3, rel_widths = c(8, 0.5, 5))
figure2
ggsave(filename = paste0(output_dir, "/figure_TP53.pdf"), plot = figure2)
ggsave(filename = paste0(output_dir, "/figure_TP53.svg"), plot = figure2)


```



### Figure 10
supplement figure Methylation groups
```{r fig2 objects}

de4 <- readRDS(paste0(fig_dir,"/Methylation/de_genes/MSI2.rds"))
de1 <- readRDS(paste0(fig_dir,"/Methylation/de_genes/NFATC1.rds"))
de2 <- readRDS(paste0(fig_dir,"/Methylation/de_genes/EGR1.rds"))
de3 <- readRDS(paste0(fig_dir,"/Methylation/de_genes/SOX11.rds"))

```


```{r fig2 plot, fig.width=16, fig.height= 14}
#Align subplots
#pathw <- plot_grid(NULL, pathways, NULL, ncol = 3, rel_widths = c(1, 8, 1))
p_sub <- plot_grid(de1, de2, ncol = 2, rel_widths = c(1,1), labels = c('A','B'), label_size = 45)
p_sub2 <- plot_grid(de3, de4, ncol = 2, rel_widths = c(1,1), labels = c('C','D'), label_size = 45)


figure10 <- plot_grid(p_sub, NULL, p_sub2, ncol = 1, rel_heights = c(1, 0.1, 1))
figure10
ggsave(filename = paste0(output_dir, "/figure_meth_genes.pdf"), plot = figure10)
ggsave(filename = paste0(output_dir, "/figure_meth_genes.svg"), plot = figure10)


```


## Figure epistasis abruzzo

```{r fig abruzzo objects}

epi_hmap <-  readRDS(paste0(fig_dir,"/epistasis/epistasis_heatmap_abruzzo.rds"))
epi_hmap <- grid.grabExpr(draw(epi_hmap))
#types <- readRDS(paste0(fig_dir,"/epistasis/epistasis_scheme_lolli.rds"))
#types <- grid.grabExpr(draw(types))
#path_epi <- readRDS(paste0(fig_dir,"/epistasis/enrich_dot_buffering.rds"))

de1 <- readRDS(paste0(fig_dir,"/epistasis/abruzzo/de_genes/EBF1.rds"))
de2 <- readRDS(paste0(fig_dir,"/epistasis/abruzzo/de_genes/FGF2.rds"))
#de3 <- readRDS(paste0(fig_dir,"/epistasis/abruzzo/de_genes/SYBU.rds"))
de4 <- readRDS(paste0(fig_dir,"/epistasis/abruzzo/de_genes/LEF1.rds"))


```


```{r fig abruzzo plot, fig.width=18, fig.height= 24}
#Align subplots
p_sub2 <- plot_grid(de1, de2, de4, ncol = 1, align = "v", axis = "b", labels = c('A', 'B', 'C'), label_size = 45)
p_sub3 <- plot_grid(NULL, p_sub2, NULL, ncol = 3, rel_widths = c(1.5 , 10, 1.5))
#p_sub1 <- plot_grid(types, NULL,  ncol = 2, rel_widths = c(10, 1))
p_sub6 <- plot_grid(NULL, epi_hmap,  ncol = 2, rel_widths = c(1, 10))
p_sub <- plot_grid(NULL, p_sub1, NULL, p_sub6, ncol = 1, rel_heights = c(0.5, 4.5, 0.5, 8), labels = c('E','', 'G',''), label_size = 45)

p_sub5 <- plot_grid(p_sub2, NULL, path_epi, ncol = 1, rel_heights = c(13, 0.5, 4), labels = c("", "F", ""), label_size = 45)

figure4 <- plot_grid(p_sub5, NULL, p_sub, ncol = 3, rel_widths = c(10, 0.1, 11))
figure4
ggsave(filename = paste0(output_dir, "/figure_epi_abruzzo.pdf"), plot = figure4)
ggsave(filename = paste0(output_dir, "/figure_epi_abruzzo.svg"), plot = figure4)
```


